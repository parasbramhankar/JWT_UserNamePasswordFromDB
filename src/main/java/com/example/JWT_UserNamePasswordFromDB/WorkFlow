 ğŸ§  Big Picture â€“ Banking JWT App

Tumhare app me ye sab cheezein hain:

âœ… Database (users + roles)
âœ… Login system
âœ… JWT token
âœ… Filter
âœ… Role based access
âœ… Controllers

---

---

 ğŸ¬ Full Request Life Cycle

```
Client â†’ Filter â†’ Security â†’ Controller â†’ Service â†’ DB
```

and response same path se wapas.

---

---

 ğŸŸ¢ SCENARIO 1 â€“ USER LOGIN (Token banana)

User abhi login kar raha hai.

---

 Step 1 â€“ Client hits login API

```
POST /auth/login
```

Body:

```
username + password
```

---

 Step 2 â€“ SecurityConfig allow karta hai

Because:

```
/auth/** â†’ permitAll()
```

Toh filter token check nahi karega.

Direct controller me jaane dega.

---

 Step 3 â€“ AuthController

```java
service.login(dto);
```

---

 Step 4 â€“ AuthService

Ye sabse important part ğŸ”¥

```java
manager.authenticate(
   new UsernamePasswordAuthenticationToken(username, password)
);
```

---

 Step 5 â€“ AuthenticationManager kya karta hai?

Spring internally:

ğŸ‘‰ CustomUserDetailsService ko call karta hai
ğŸ‘‰ DB se user laata hai
ğŸ‘‰ password match karta hai

---

 Agar wrong:

âŒ exception

 Agar correct:

âœ… success

---

 Step 6 â€“ JWT Generate

```java
jwtService.generateToken(username);
```

Token bana.

---

 Step 7 â€“ Token Client ko mil gaya

Ab client bolega:

ğŸ§  â€œAb main har request me ye token bhejunga.â€

---

---

---

 ğŸ”µ SCENARIO 2 â€“ Secure API Call (Real Game ğŸ”¥)

Now user calls:

```
GET /user/balance
```

Header:

```
Authorization: Bearer token
```

---

---

 Step 1 â€“ Request enters Spring

Controller tak jaane se pehle:

ğŸ‘‰ filter chain me jaata hai.

---

 Step 2 â€“ JWT Filter Activated

Because we wrote:

```java
addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class);
```

---

Filter bolega:

ğŸ§  â€œToken dikhao pehle.â€

---

---

 Step 3 â€“ Extract Username

```java
username = jwtService.extractUsername(token);
```

Example:

```
paras
```

---

---

 Step 4 â€“ Load User From DB

```java
loadUserByUsername("paras");
```

Now Spring gets:

```
username = paras
role = ADMIN
```

---

---

 Step 5 â€“ Validate Token

Check:

âœ” username match
âœ” expired nahi
âœ” signature correct

---

---

 Step 6 â€“ MOST IMPORTANT STEP ğŸš¨

```java
SecurityContextHolder.getContext()
    .setAuthentication(...)
```

Ab Spring ke dimaag me:

```
paras is LOGGED IN
Role = ADMIN
```

ğŸ”¥ğŸ”¥ğŸ”¥

---

---

 Step 7 â€“ Now Authorization Happens

SecurityConfig bolega:

```
/user/** â†’ USER or ADMIN
```

paras = ADMIN
â†’ allowed âœ…

---

---

 Step 8 â€“ Controller Runs

```java
@GetMapping("/balance")
```

Now business logic chalega.

---

---

 ğŸ§¨ Agar Token Galat Ho?

Filter:

âŒ authentication set nahi karega.

Spring bolega:

```
401 Unauthorized
```

Controller tak jaane hi nahi dega.

---

---

---

 ğŸ¯ One Line Memory Trick

```
Login â†’ token milta hai
Next requests â†’ filter user banata hai
```

---

---

 ğŸ§  Internal Responsibility Division

| Layer           | Kaam             |
| --------------- | ---------------- |
| Controller      | API              |
| Service         | logic            |
| Repository      | DB               |
| JWT Service     | token            |
| Filter          | security         |
| SecurityContext | logged in memory |

---

---

 ğŸ¦ Banking Real Example

Imagine:

You login into bank app.

Then:

* check balance
* transfer
* statement

Har baar password nahi dalte âŒ
Token hi identity hota hai âœ…

---

---

 ğŸ‰ Tumhari App Ab Ban Gayi

âœ… Stateless
âœ… Secure
âœ… Role aware
âœ… DB driven
âœ… Professional
